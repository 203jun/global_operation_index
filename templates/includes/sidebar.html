
	<!-- [ navigation menu ] start -->
	<nav class="pcoded-navbar menupos-fixed menu-light ">
		<div
			class="navbar-wrapper  ">
			<div class="navbar-content scroll-div "
				>
				<!-- Info 섹션 -->
				<div class="sidebar-info-section" style="padding: 15px 20px; border-bottom: 1px solid #e0e0e0; background: #f8f9fa;">
					<div class="nav-item pcoded-menu-caption" style="margin-bottom: 15px;">
						<label>Info</label>
					</div>
					<div class="info-item" style="margin-bottom: 10px;">
						<span style="font-size: 0.8rem; color: #666; font-weight: 500;">기준월</span>
						<span class="dropdown" style="margin-left: 8px; display: inline-block;">
							<button id="monthButton" class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" style="font-size: 0.8rem; padding: 2px 8px;">
								9월
							</button>
							<ul class="dropdown-menu" id="monthDropdown" style="font-size: 0.8rem;">
								<li><a class="dropdown-item month-option" href="#" data-month="1">1월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="2">2월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="3">3월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="4">4월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="5">5월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="6">6월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="7">7월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="8">8월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="9">9월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="10">10월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="11">11월</a></li>
								<li><a class="dropdown-item month-option" href="#" data-month="12">12월</a></li>
							</ul>
						</span>
					</div>
					<div class="info-item" style="margin-bottom: 10px;">
						<span style="font-size: 0.8rem; color: #666; font-weight: 500;">Subsidiary</span>
						<span class="dropdown" style="margin-left: 8px; display: inline-block;">
							<button id="subsidiaryButton" class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" style="font-size: 0.8rem; padding: 2px 8px;">
								전체
							</button>
							<ul id="subsidiaryDropdown" class="dropdown-menu" style="font-size: 0.8rem; max-height: 200px; overflow-y: auto;">
								<li><a class="dropdown-item" href="#">로딩중...</a></li>
							</ul>
						</span>
					</div>
				</div>

				<ul class="nav pcoded-inner-navbar ">
					<li class="nav-item pcoded-menu-caption">
						<label>Link</label>
					</li>
					<li class="nav-item">
						<a href="/global" class="nav-link "><span class="pcoded-micon"><i class="feather icon-globe"></i></span><span
								class="pcoded-mtext">Global</span></a>
					</li>
					<li class="nav-item pcoded-hasmenu">
						<a href="#!" class="nav-link "><span class="pcoded-micon"><i class="feather icon-map"></i></span><span
								class="pcoded-mtext">Region</span></a>
						<ul id="regionSubmenu" class="pcoded-submenu">
							<li><a href="#!">로딩중...</a></li>
						</ul>
					</li>
					<li class="nav-item">
						<a href="/subsidiary" class="nav-link "><span class="pcoded-micon"><i class="feather icon-feather"></i></span><span
								class="pcoded-mtext">Subsidiary</span></a>
					</li>

					<li class="nav-item pcoded-menu-caption">
						<label>Raw Data</label>
					</li>
					<li class="nav-item">
						<a href="#!" class="nav-link "><span class="pcoded-mtext" style="font-size: 0.7rem;">hong_data_manager_final</span></a>
					</li>
					<li class="nav-item">
						<a href="#!" class="nav-link "><span class="pcoded-mtext" style="font-size: 0.7rem;">hong_data_plan_final</span></a>
					</li>
				</ul>

				<div class="card text-center">
					<div class="card-body px-3">
						<i class="feather icon-sunset f-40"></i>
						<h6 class="mt-3">Upgrade to Pro</h6>
						<p>To get more features and components</p>
						<a href="https://appseed.us/product/gradient-able-pro/flask/" target="_blank"
							class="btn btn-primary btn-sm text-white m-0">Buy now</a>
					</div>
				</div>

			</div>
		</div>
	</nav>
	<!-- [ navigation menu ] end -->

	<script>
	document.addEventListener('DOMContentLoaded', function() {
		// 기준월 dropdown 이벤트 리스너
		const monthOptions = document.querySelectorAll('.month-option');
		const monthButton = document.getElementById('monthButton');
		const subsidiaryDropdown = document.getElementById('subsidiaryDropdown');
		const subsidiaryButton = document.getElementById('subsidiaryButton');
		const regionSubmenu = document.getElementById('regionSubmenu');

		// URL에서 현재 월 가져오기 (없으면 기본값 9월)
		const urlParams = new URLSearchParams(window.location.search);
		let currentMonth = parseInt(urlParams.get('month')) || 9;

		// 버튼 텍스트 업데이트
		monthButton.textContent = `${currentMonth}월`;

		// 월 선택 이벤트 리스너
		monthOptions.forEach(option => {
			option.addEventListener('click', function(e) {
				e.preventDefault();

				const selectedMonth = parseInt(this.getAttribute('data-month'));
				const monthText = this.textContent;

				// 버튼 텍스트 업데이트
				monthButton.textContent = monthText;
				currentMonth = selectedMonth;

				// API 호출하여 subsidiary와 region 목록 가져오기
				loadSubsidiaries(selectedMonth);
				loadRegions(selectedMonth);

				// 현재 URL에 month 파라미터 추가하여 페이지 새로고침
				const currentPath = window.location.pathname;
				const newUrl = `${currentPath}?month=${selectedMonth}`;
				window.location.href = newUrl;
			});
		});

		// API 호출 함수
		function loadSubsidiaries(month) {
			console.log(`Loading subsidiaries for month ${month}`);
			// 로딩 상태 표시
			subsidiaryButton.textContent = '로딩중...';
			subsidiaryDropdown.innerHTML = '<li><a class="dropdown-item" href="#">로딩중...</a></li>';

			// API 호출
			fetch(`/api/subsidiaries/${month}`)
				.then(response => response.json())
				.then(data => {
					console.log(`API Response for month ${month}:`, data);
					if (data.success) {
						console.log(`Loaded ${data.subsidiaries.length} subsidiaries`);
						updateSubsidiaryDropdown(data.subsidiaries);
					} else {
						console.error('API Error:', data.error);
						showError('데이터를 불러오는데 실패했습니다.');
					}
				})
				.catch(error => {
					console.error('Network Error:', error);
					showError('네트워크 오류가 발생했습니다.');
				});
		}

		// Region 로딩 함수
		function loadRegions(month) {
			console.log(`Loading regions for month ${month}`);
			// 로딩 상태 표시
			regionSubmenu.innerHTML = '<li><a href="#!">로딩중...</a></li>';

			// API 호출
			fetch(`/api/regions/${month}`)
				.then(response => response.json())
				.then(data => {
					console.log(`Region API Response for month ${month}:`, data);
					if (data.success) {
						console.log(`Loaded ${data.regions.length} regions`);
						updateRegionSubmenu(data.regions);
					} else {
						console.error('Region API Error:', data.error);
						showRegionError('데이터를 불러오는데 실패했습니다.');
					}
				})
				.catch(error => {
					console.error('Region Network Error:', error);
					showRegionError('네트워크 오류가 발생했습니다.');
				});
		}

		// Region 하위 메뉴 업데이트
		function updateRegionSubmenu(regions) {
			regionSubmenu.innerHTML = '';

			if (regions.length === 0) {
				const noDataOption = document.createElement('li');
				noDataOption.innerHTML = '<a href="#!">데이터 없음</a>';
				regionSubmenu.appendChild(noDataOption);
				return;
			}

			// 각 region 옵션 추가
			regions.forEach(region => {
				const option = document.createElement('li');
				// Region 페이지로 이동하되 쿼리 파라미터로 선택된 region과 기준월 전달
				option.innerHTML = `<a href="/region/${encodeURIComponent(region)}?month=${currentMonth}" data-region="${region}">${region}</a>`;
				regionSubmenu.appendChild(option);
			});

			// pcoded.js 메뉴 이벤트 다시 초기화 (더 긴 지연 후)
			setTimeout(() => {
				if (typeof window.pcoded !== 'undefined' && window.pcoded.init) {
					try {
						window.pcoded.init();
					} catch (error) {
						console.warn('pcoded 재초기화 중 오류:', error);
					}
				}
			}, 300);
		}

		// Region 에러 표시 함수
		function showRegionError(message) {
			regionSubmenu.innerHTML = `<li><a href="#!">${message}</a></li>`;
		}

		// Subsidiary dropdown 업데이트
		function updateSubsidiaryDropdown(subsidiaries) {
			// 버튼 텍스트 업데이트
			if (subsidiaries.length > 0) {
				subsidiaryButton.textContent = '전체';
			} else {
				subsidiaryButton.textContent = '데이터 없음';
			}

			// dropdown 메뉴 업데이트
			subsidiaryDropdown.innerHTML = '';

			// 전체 옵션 추가
			const allOption = document.createElement('li');
			allOption.innerHTML = `<a class="dropdown-item" href="/subsidiary?month=${currentMonth}" data-subsidiary="all">전체</a>`;
			subsidiaryDropdown.appendChild(allOption);

			// 각 subsidiary 옵션 추가
			subsidiaries.forEach(subsidiary => {
				const option = document.createElement('li');
				// Subsidiary 상세 페이지로 이동하되 쿼리 파라미터로 현재 월 전달
				option.innerHTML = `<a class="dropdown-item" href="/subsidiary/${encodeURIComponent(subsidiary)}?month=${currentMonth}" data-subsidiary="${subsidiary}">${subsidiary}</a>`;
				subsidiaryDropdown.appendChild(option);
			});

			// pcoded.js 메뉴 이벤트 다시 초기화 (더 긴 지연 후)
			setTimeout(() => {
				if (typeof window.pcoded !== 'undefined' && window.pcoded.init) {
					try {
						window.pcoded.init();
					} catch (error) {
						console.warn('pcoded 재초기화 중 오류:', error);
					}
				}
			}, 300);
		}

		// 에러 표시 함수
		function showError(message) {
			subsidiaryButton.textContent = '오류';
			subsidiaryDropdown.innerHTML = `<li><a class="dropdown-item" href="#">${message}</a></li>`;
		}

		// 페이지 로드 시 8월 데이터 로드
		loadSubsidiaries(currentMonth);
		loadRegions(currentMonth);

		// DOM이 완전히 로드된 후 pcoded 초기화
		document.addEventListener('DOMContentLoaded', function() {
			setTimeout(() => {
				if (typeof window.pcoded !== 'undefined' && window.pcoded.init) {
					try {
						window.pcoded.init();
					} catch (error) {
						console.warn('초기 pcoded 초기화 중 오류:', error);
					}
				}
			}, 500);
		});
	});
	</script>
